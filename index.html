<html>
	<head>
		<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
		<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
		<script src="https://code.angularjs.org/1.4.5/angular.min.js"></script>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
		<script>
			angular.module("myapp", [])

			.directive("datepicker", function() {
			  return {
				restrict: "E",
				replace: true,
				scope: {
					date: "=",
					defaultdate: "="
				},
				template: "<input type='text' ng-model='dateText' ng-class='{\"invalid\": !valid}'/>",
				link: function (scope, elem, attrs, ngModelCtrl) {
					elem.datepicker({
						dateFormat: scope.format,
						defaultDate: scope.defaultdate,
						onSelect: function (dateText, inst) {
							scope.dateText = dateText;
							scope.$apply();
						}
					});
				},
				controller: function($scope, dateFilter) {
					$scope.valid = true;
					$scope.format = "dd.mm.yy";
					$scope.dateText = $.datepicker.formatDate($scope.format, $scope.defaultdate);
					
					$scope.$watch("dateText", function() {
						try {
							var date = $.datepicker.parseDate($scope.format, $scope.dateText);
							$scope.date = $.datepicker.formatDate("yy-mm-dd", date) + "T00:00:00.000Z";
							$scope.valid = true;
						} catch (e) {
							$scope.valid = false;
							$scope.date = undefined;
							console.log(e);
						}
					});
				}
			  };
			})
			.controller("myctrl", ["$scope", function($scope) {
				$scope.dd1 = new Date();
				$scope.dd1.setFullYear(2014);
				$scope.dd2 = new Date();
				$scope.dd2.setFullYear(2013);
			}]);
		</script>
		<style>
			.invalid { border: 1px solid red;}
		</style>
	</head>
	<body>
	<div ng-app="myapp">
		<div ng-controller="myctrl">
			<p>{{date1}}</p>
			<datepicker date="date1" defaultdate="dd1" ></datepicker>
			<p>{{date2}}</p>
			<datepicker date="date2" defaultdate="dd2"></datepicker>
		</div>
	</div>
	</body>
</html>